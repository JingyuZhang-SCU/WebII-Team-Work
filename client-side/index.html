<!DOCTYPE html>
<html lang="en" ng-app="charityApp">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Charity Events - Home</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.2/angular.min.js"></script>
</head>
<body ng-controller="HomeController">
    <!-- Navigation -->
    <nav>
        <ul>
            <li><a href="index.html">Home</a></li>
            <li><a href="search.html">Search Events</a></li>
        </ul>
    </nav>

    <div class="container">
        <div class="card">
            <h1>Welcome to Charity Events</h1>
            <div class="welcome-text">
                <p>Discover meaningful events and make a difference</p>
                <p>Browse upcoming charity events, search by category or location, and register to participate!</p>
            </div>
            <div class="contact-info">
                <h2 style="color: white; margin-bottom: 20px;">Contact Us</h2>
                <p>ğŸ“§ Email: contact@charityevents.org</p>
                <p>ğŸ“ Phone: +61 1800 123 456</p>
                <p>ğŸ“ Address: 123 Charity Street, Sydney NSW 2000</p>
            </div>
        </div>

        <div class="card">
            <h2>Upcoming Events</h2>
            
            <!-- LoadingçŠ¶æ€ -->
            <div ng-show="loading" class="loading">Loading events...</div>
            
            <!-- é”™è¯¯æç¤º -->
            <div ng-show="error" class="no-results">{{error}}</div>
            
            <!-- æ´»åŠ¨åˆ—è¡¨ -->
            <div ng-show="!loading && !error" class="event-grid">
                <div ng-repeat="event in events" class="event-card" ng-click="goToDetails(event.id)">
                    <h3>{{event.name}}</h3>
                    <p><strong>ğŸ“… Date:</strong> {{event.date | date:'medium'}}</p>
                    <p><strong>ğŸ“ Location:</strong> {{event.location}}</p>
                    <p><strong>ğŸ·ï¸ Category:</strong> {{event.category_name}}</p>
                    <p><strong>ğŸ’° Ticket Price:</strong> ${{event.ticket_price}}</p>
                    <div class="progress-bar">
                        <div class="progress-fill" ng-style="{'width': getProgress(event) + '%'}"></div>
                    </div>
                    <p class="progress-text">
                        ${{event.current_amount}} / ${{event.goal_amount}} raised ({{getProgress(event)}}%)
                    </p>
                </div>
                
                <!-- æ²¡æœ‰æ´»åŠ¨ -->
                <div ng-show="events.length === 0" class="no-results">
                    No upcoming events available
                </div>
            </div>
        </div>
    </div>

    <script>
        // AngularJSåº”ç”¨å’Œæ§åˆ¶å™¨
        var app = angular.module('charityApp', []);
        
        app.controller('HomeController', function($scope, $http, $window) {
            $scope.events = [];
            $scope.loading = true;
            $scope.error = null;
            
            // åŠ è½½æ´»åŠ¨åˆ—è¡¨
            $scope.loadEvents = function() {
                $http.get('http://localhost:3000/api/events')
                    .then(function(response) {
                        $scope.events = response.data;
                        $scope.loading = false;
                    })
                    .catch(function(error) {
                        console.error('Error loading events:', error);
                        $scope.error = 'Failed to load events. Please try again later.';
                        $scope.loading = false;
                    });
            };
            
            // è®¡ç®—è¿›åº¦ç™¾åˆ†æ¯”
            $scope.getProgress = function(event) {
                if (!event.goal_amount || event.goal_amount === 0) return 0;
                return Math.min(Math.round((event.current_amount / event.goal_amount) * 100), 100);
            };
            
            // è·³è½¬åˆ°æ´»åŠ¨è¯¦æƒ…é¡µ
            $scope.goToDetails = function(eventId) {
                $window.location.href = 'event-details.html?id=' + eventId;
            };
            
            // åˆå§‹åŒ–åŠ è½½
            $scope.loadEvents();
        });
    </script>
</body>
</html>