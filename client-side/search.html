<!DOCTYPE html>
<html lang="en" ng-app="charityApp">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Search Events - Charity Events</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.2/angular.min.js"></script>
</head>
<body ng-controller="SearchController">
    <!-- Navigation -->
    <nav>
        <ul>
            <li><a href="index.html">Home</a></li>
            <li><a href="search.html">Search Events</a></li>
        </ul>
    </nav>

    <div class="container">
        <div class="card">
            <h1>Search Events</h1>
            <form class="search-form" ng-submit="searchEvents()">
                <div class="form-group">
                    <label for="category">Category:</label>
                    <select id="category" ng-model="searchParams.category">
                        <option value="">All Categories</option>
                        <option ng-repeat="cat in categories" value="{{cat.name}}">{{cat.name}}</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="location">Location:</label>
                    <input type="text" id="location" ng-model="searchParams.location" 
                           placeholder="Enter location">
                </div>
                
                <div class="form-group">
                    <label for="date">Date:</label>
                    <input type="date" id="date" ng-model="searchParams.date">
                </div>
                
                <div style="display: flex; gap: 15px; margin-top: 10px;">
                    <button type="submit">Search</button>
                    <button type="button" ng-click="clearFilters()">Clear Filters</button>
                </div>
            </form>
        </div>

        <div class="card">
            <h2>Search Results</h2>
            
            <!-- LoadingÁä∂ÊÄÅ -->
            <div ng-show="loading" class="loading">Searching...</div>
            
            <!-- ÂàùÂßãÁä∂ÊÄÅ -->
            <div ng-show="!searched && !loading" class="no-results">
                Enter search criteria and click "Search"
            </div>
            
            <!-- ÊêúÁ¥¢ÁªìÊûú -->
            <div ng-show="searched && !loading" class="event-grid">
                <div ng-repeat="event in results" class="event-card" ng-click="goToDetails(event.id)">
                    <h3>{{event.name}}</h3>
                    <p><strong>üìÖ Date:</strong> {{event.date | date:'medium'}}</p>
                    <p><strong>üìç Location:</strong> {{event.location}}</p>
                    <p><strong>üè∑Ô∏è Category:</strong> {{event.category_name}}</p>
                    <p><strong>üí∞ Ticket Price:</strong> ${{event.ticket_price}}</p>
                </div>
                
                <!-- Ê≤°ÊúâÁªìÊûú -->
                <div ng-show="results.length === 0" class="no-results">
                    No events found matching your criteria
                </div>
            </div>
        </div>
    </div>

    <script>
        var app = angular.module('charityApp', []);
        
        app.controller('SearchController', function($scope, $http, $window) {
            $scope.categories = [];
            $scope.searchParams = {
                category: '',
                location: '',
                date: ''
            };
            $scope.results = [];
            $scope.loading = false;
            $scope.searched = false;
            
            // Âä†ËΩΩÂàÜÁ±ªÂàóË°®
            $scope.loadCategories = function() {
                $http.get('http://localhost:3000/api/categories')
                    .then(function(response) {
                        $scope.categories = response.data;
                    })
                    .catch(function(error) {
                        console.error('Error loading categories:', error);
                    });
            };
            
            // ÊêúÁ¥¢Ê¥ªÂä®
            $scope.searchEvents = function() {
                $scope.loading = true;
                $scope.searched = true;
                
                // ÊûÑÂª∫Êü•ËØ¢ÂèÇÊï∞
                var params = {};
                if ($scope.searchParams.category) params.category = $scope.searchParams.category;
                if ($scope.searchParams.location) params.location = $scope.searchParams.location;
                if ($scope.searchParams.date) params.date = $scope.searchParams.date;
                
                $http.get('http://localhost:3000/api/events/search', { params: params })
                    .then(function(response) {
                        $scope.results = response.data;
                        $scope.loading = false;
                    })
                    .catch(function(error) {
                        console.error('Error searching events:', error);
                        $scope.results = [];
                        $scope.loading = false;
                    });
            };
            
            // Ê∏ÖÈô§Á≠õÈÄâ
            $scope.clearFilters = function() {
                $scope.searchParams = {
                    category: '',
                    location: '',
                    date: ''
                };
                $scope.results = [];
                $scope.searched = false;
            };
            
            // Ë∑≥ËΩ¨Âà∞ËØ¶ÊÉÖÈ°µ
            $scope.goToDetails = function(eventId) {
                $window.location.href = 'event-details.html?id=' + eventId;
            };
            
            // ÂàùÂßãÂåñ
            $scope.loadCategories();
        });
    </script>
</body>
</html>